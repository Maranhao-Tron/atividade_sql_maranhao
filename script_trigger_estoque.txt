/* TRIGGER ATUALIZAR ESTOQUE QUANDO VENDE */
CREATE TRIGGER TRG_ATUALIZA_ESTOQUE_VENDA FOR VENDAS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
	UPDATE PRODUTOS
	SET PRODUTOS.PRO_QTD = PRODUTOS.PRO_QTD - NEW.VEN_QTD
	WHERE PRODUTOS.PRO_ID = NEW.VEN_PRO_ID;
END

/* TRIGGER ATUALIZAR ESTOQUE QUANDO COMPRA */
CREATE TRIGGER TRG_ATUALIZA_ESTOQUE_COMPRA FOR COMPRAS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
	UPDATE PRODUTOS
	SET PRODUTOS.PRO_QTD = PRODUTOS.PRO_QTD + NEW.CMP_QTD
	WHERE PRODUTOS.PRO_ID = NEW.CMP_PRO_ID;
END

/* PROCEDURE PARA ALTERAÇÃO MANUAL DE ESTOQUE */
CREATE PROCEDURE alteraEstoque (P_ID integer, P_NEW_QTD integer)
AS
BEGIN
    UPDATE PRODUTOS
    SET PRODUTOS.PRO_QTD = :P_NEW_QTD
    WHERE PRODUTOS.PRO_ID = :P_ID;
END