/* CONSULTAS */

/* RELATÓRIO SIMPLIFICADO DE VENDAS COM NOME DO CLIENTE, PRODUTO E VALOR TOTAL*/
SELECT 
    V.VEN_ID,
    V.VEN_DATA,
    C.CLI_NOME AS CLIENTE,
    P.PRO_NOME AS PRODUTO,
    V.VEN_QTD,
    V.VEN_VALOR_TOTAL
FROM VENDAS V
INNER JOIN CLIENTES C ON V.VEN_CLIENTE_ID = C.CLI_ID
INNER JOIN PRODUTOS P ON V.VEN_PRO_ID = P.PRO_ID;


/* RELATÓRIO LUCRO UNITÁRIO E LUCRO TOTAL DE VENDAS */
SELECT 
    P.PRO_ID,
    P.PRO_NOME AS PRODUTO,
    (P.PRO_PRECO_VENDA - P.PRO_PRECO_CUSTO) AS LUCRO_UNITARIO,
    (SUM(V.VEN_QTD * P.PRO_PRECO_VENDA) - SUM(C.CMP_QTD * P.PRO_PRECO_CUSTO)) AS LUCRO_TOTAL
FROM PRODUTOS P
LEFT JOIN COMPRAS C ON P.PRO_ID = C.CMP_PRO_ID
LEFT JOIN VENDAS V ON P.PRO_ID = V.VEN_PRO_ID
GROUP BY P.PRO_ID, P.PRO_NOME, P.PRO_PRECO_VENDA, P.PRO_PRECO_CUSTO
ORDER BY LUCRO_TOTAL DESC;


/* RELATÓRIO TOTAL DE COMPRAS POR PRODUTO */
SELECT 
    C.CMP_FORNECEDOR,
    P.PRO_NOME AS PRODUTO,
    SUM(C.CMP_QTD) AS QUANTIDADE_TOTAL,
    SUM(C.CMP_VALOR_TOTAL) AS VALOR_TOTAL
FROM PRODUTOS P
RIGHT JOIN COMPRAS C ON P.PRO_ID = C.CMP_PRO_ID
GROUP BY C.CMP_FORNECEDOR, P.PRO_NOME
ORDER BY P.PRO_NOME;


/* RELAÇÃO DE QTD COMPRADA X QTD VENDIDA POR PRODUTO */
SELECT 
    COALESCE(P.PRO_ID, C.CMP_PRO_ID, V.VEN_PRO_ID) AS ID_PRODUTO,
    COALESCE(P.PRO_NOME, C.CMP_PRO_NOME, V.VEN_PRO_NOME) AS PRODUTO,
    COALESCE(SUM(C.CMP_QTD), 0) AS QUANTIDADE_COMPRADA,
    COALESCE(SUM(V.VEN_QTD), 0) AS QUANTIDADE_VENDIDA
FROM PRODUTOS P
FULL JOIN COMPRAS C ON P.PRO_ID = C.CMP_PRO_ID
FULL JOIN VENDAS V ON P.PRO_ID = V.VEN_PRO_ID
GROUP BY COALESCE(P.PRO_ID, C.CMP_PRO_ID, V.VEN_PRO_ID),
         COALESCE(P.PRO_NOME, C.CMP_PRO_NOME, V.VEN_PRO_NOME)
ORDER BY ID_PRODUTO;



